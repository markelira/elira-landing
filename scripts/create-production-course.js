const admin = require('firebase-admin');

// Initialize Firebase Admin for production
if (!admin.apps.length) {
  // Load service account credentials for production
  const serviceAccount = {
    projectId: process.env.FIREBASE_PROJECT_ID,
    clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
    privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
  };
  
  admin.initializeApp({
    credential: admin.credential.cert(serviceAccount),
    projectId: process.env.FIREBASE_PROJECT_ID
  });
}

const db = admin.firestore();

async function createProductionCourse() {
  try {
    console.log('üå± Creating production course...');
    
    // Create the AI copywriting course
    const courseId = 'ai-copywriting-course';
    const courseData = {
      title: 'Olvass a vev≈ëid gondolataiban',
      slug: 'ai-copywriting-course',
      description: 'AI-alap√∫ copywriting √©s marketingkutat√°s kurzus. K√©pzeld el, hogy percek alatt k√©sz√≠tesz buyer person√°t, pontosan felt√©rk√©pezed a piacodat, √©s az MI-vel olyan sz√∂vegeket √≠rsz, amelyek nem csak a figyelmet ragadj√°k meg, hanem profitot is termelnek.',
      shortDescription: 'Tanulj meg hat√©kony sz√∂vegeket √≠rni AI eszk√∂z√∂kkel √©s ChatGPT-vel.',
      status: 'PUBLISHED',
      visibility: 'PUBLIC',
      
      // Instructor
      instructorId: 'zoltan-somosi',
      instructorName: 'Somosi Zolt√°n',
      instructorEmail: 'zoltan@elira.hu',
      instructorBio: 'Marketing Specialista & Doktorandusz',
      instructorPhotoUrl: '/IMG_5730.JPG',
      
      // Category
      categoryId: 'ai-marketing',
      categoryName: 'AI Marketing',
      language: 'hu',
      difficulty: 'INTERMEDIATE',
      
      // Media
      thumbnailUrl: '/Cover_Olvass_a_vev≈ëid_gondolataiban-min.png',
      previewVideoUrl: 'https://player.mux.com/tTZjKcQAhn0233X1jBoj4UARa2nEKnEDRarPGZNUJ2Gg',
      
      // Pricing - CRITICAL for Stripe
      price: 89990,
      currency: 'HUF',
      isFree: false,
      stripePriceId: 'price_1S0MvyHhqyKpFIBMQdiSPodM', // Existing Stripe price ID
      
      // Learning
      objectives: [
        'Buyer persona kidolgoz√°sa 10 perc alatt MI seg√≠ts√©g√©vel',
        'Versenyt√°rs anal√≠zis automatiz√°l√°sa AI eszk√∂z√∂kkel',
        'Pszichol√≥giai triggerek alkalmaz√°sa a copywritingban',
        'Email marketing automatiz√°ci√≥ k√©sz√≠t√©se',
        'Facebook Ads copy gener√°tor haszn√°lata',
        'Social media tartalom tervez√©s AI-val'
      ],
      prerequisites: [
        'Alapvet≈ë sz√°m√≠t√≥g√©pes ismeretek',
        'Magyar nyelv magas szint≈± ismerete',
        'Nyitotts√°g az √∫j technol√≥gi√°k ir√°nt',
        'V√°llalkoz√≥i vagy marketinges h√°tt√©r el≈ëny'
      ],
      
      // Settings
      certificateEnabled: true,
      isPlus: true,
      
      // Stats
      enrollmentCount: 312,
      completionCount: 89,
      averageRating: 4.9,
      totalReviews: 89,
      
      // Content stats
      totalModules: 5,
      totalLessons: 17,
      totalDuration: 3300, // 55 minutes in seconds
      
      // Timestamps
      createdAt: admin.firestore.FieldValue.serverTimestamp(),
      updatedAt: admin.firestore.FieldValue.serverTimestamp(),
      publishedAt: admin.firestore.FieldValue.serverTimestamp()
    };
    
    // Save course to production Firestore
    await db.collection('courses').doc(courseId).set(courseData);
    console.log('‚úÖ Production course created:', courseId);
    
    console.log('\nüéâ Production course created successfully!');
    console.log(`üìç Course ID: ${courseId}`);
    console.log(`üí∞ Price: ${courseData.price} ${courseData.currency}`);
    console.log(`üé´ Stripe Price ID: ${courseData.stripePriceId}`);
    console.log(`üîó View at: https://elira-landing.vercel.app/courses/${courseId}`);
    
  } catch (error) {
    console.error('‚ùå Error creating production course:', error);
  } finally {
    process.exit(0);
  }
}

createProductionCourse();