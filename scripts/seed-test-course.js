const admin = require('firebase-admin');

// Initialize Firebase Admin for emulator
process.env.FIREBASE_AUTH_EMULATOR_HOST = '127.0.0.1:9099';
process.env.FIRESTORE_EMULATOR_HOST = '127.0.0.1:8080';

if (!admin.apps.length) {
  admin.initializeApp({
    projectId: 'elira-landing-ce927'
  });
}

const db = admin.firestore();

async function seedTestCourse() {
  try {
    console.log('üå± Seeding test course...');
    
    // Create a test course (matching production structure)
    const courseId = 'ai-copywriting-course';
    const courseData = {
      title: 'AI Copywriting Kurzus - Teljes Program',
      slug: 'ai-copywriting-course',
      description: `Ez a gyakorlatorient√°lt kurzus mindent megtan√≠t, amit tudnod kell a modern AI-alap√∫ copywritingr√≥l.
      
      A kurzus sor√°n megismered a ChatGPT √©s m√°s AI eszk√∂z√∂k hat√©kony haszn√°lat√°t, megtanulod a prompt engineering alapjait √©s halad√≥ technik√°it, valamint val√≥s projekteken kereszt√ºl gyakorolhatod a konverzi√≥t n√∂vel≈ë sz√∂vegek √≠r√°s√°t.
      
      A kurzus v√©g√©re k√©pes leszel √∂n√°ll√≥an, professzion√°lis szinten haszn√°lni az AI eszk√∂z√∂ket copywriting feladatokhoz, legyen sz√≥ landing page-ekr≈ël, email kamp√°nyokr√≥l, vagy social media tartalmakr√≥l.`,
      shortDescription: 'Tanulj meg hat√©kony sz√∂vegeket √≠rni AI eszk√∂z√∂kkel √©s ChatGPT-vel.',
      status: 'PUBLISHED',
      visibility: 'PUBLIC',
      
      // Instructor
      instructorId: 'instructor-1',
      instructorName: 'Kov√°cs Andr√°s',
      instructorEmail: 'andras@elira.hu',
      instructorBio: 'Digital marketing szak√©rt≈ë 10+ √©v tapasztalattal',
      
      // Category
      categoryId: 'marketing',
      categoryName: 'Digital Marketing',
      language: 'hu',
      difficulty: 'INTERMEDIATE',
      
      // Media
      thumbnailUrl: '/images/course-ai-copywriting.jpg',
      
      // Pricing
      price: 29900,
      currency: 'HUF',
      isFree: false,
      
      // Learning
      objectives: [
        'AI eszk√∂z√∂k hat√©kony haszn√°lata copywritinghoz',
        'ChatGPT prompt engineering technik√°k elsaj√°t√≠t√°sa',
        'Konverzi√≥t n√∂vel≈ë sz√∂vegt√≠pusok megismer√©se',
        'Landing page √©s email sz√∂vegek √≠r√°sa',
        'A/B tesztel√©s √©s optimaliz√°l√°s AI seg√≠ts√©g√©vel'
      ],
      prerequisites: [
        'Alapvet≈ë sz√°m√≠t√≥g√©pes ismeretek',
        'Magyar nyelv magas szint≈± ismerete',
        'Nyitotts√°g az √∫j technol√≥gi√°k ir√°nt'
      ],
      targetAudience: [
        'Marketing szakemberek',
        'V√°llalkoz√≥k',
        'Content creatorok',
        'Freelancer sz√∂veg√≠r√≥k'
      ],
      
      // Settings
      certificateEnabled: true,
      
      // Stats
      enrollmentCount: 234,
      completionCount: 156,
      averageRating: 4.8,
      totalReviews: 89,
      
      // Content stats
      totalModules: 3,
      totalLessons: 12,
      totalDuration: 14400, // 4 hours in seconds
      
      // Timestamps
      createdAt: admin.firestore.FieldValue.serverTimestamp(),
      updatedAt: admin.firestore.FieldValue.serverTimestamp(),
      publishedAt: admin.firestore.FieldValue.serverTimestamp()
    };
    
    // Save course
    await db.collection('courses').doc(courseId).set(courseData);
    console.log('‚úÖ Course created:', courseId);
    
    // Create modules
    const modules = [
      {
        courseId,
        title: 'AI Copywriting Alapok',
        description: 'Ismerkedj meg az AI copywriting vil√°g√°val √©s az alapvet≈ë eszk√∂z√∂kkel',
        order: 0,
        totalLessons: 4,
        totalDuration: 4800
      },
      {
        courseId,
        title: 'Halad√≥ Prompt Engineering',
        description: 'Saj√°t√≠tsd el a professzion√°lis prompt √≠r√°s m≈±v√©szet√©t',
        order: 1,
        totalLessons: 4,
        totalDuration: 4800
      },
      {
        courseId,
        title: 'Gyakorlati Projektek',
        description: 'Val√≥s p√©ld√°kon kereszt√ºl gyakorold a tanultakat',
        order: 2,
        totalLessons: 4,
        totalDuration: 4800
      }
    ];
    
    const moduleIds = [];
    for (const module of modules) {
      const moduleRef = await db.collection('modules').add({
        ...module,
        createdAt: admin.firestore.FieldValue.serverTimestamp(),
        updatedAt: admin.firestore.FieldValue.serverTimestamp()
      });
      moduleIds.push(moduleRef.id);
      console.log('‚úÖ Module created:', module.title);
    }
    
    // Create lessons
    const lessonsData = [
      // Module 1 lessons
      [
        { title: 'Bevezet√©s az AI copywritingba', duration: 1200, type: 'VIDEO' },
        { title: 'ChatGPT be√°ll√≠t√°sa √©s alapok', duration: 1200, type: 'VIDEO' },
        { title: 'Az els≈ë AI assziszt√°lt sz√∂veg', duration: 1200, type: 'VIDEO' },
        { title: 'Gyakorlati feladat: Els≈ë projekt', duration: 1200, type: 'ASSIGNMENT' }
      ],
      // Module 2 lessons
      [
        { title: 'Prompt strukt√∫r√°k √©s technik√°k', duration: 1200, type: 'VIDEO' },
        { title: 'Kontextus √©s hangnem be√°ll√≠t√°sa', duration: 1200, type: 'VIDEO' },
        { title: 'Iterat√≠v finomhangol√°s', duration: 1200, type: 'VIDEO' },
        { title: 'Halad√≥ prompt mint√°k', duration: 1200, type: 'TEXT' }
      ],
      // Module 3 lessons
      [
        { title: 'Landing page projekt', duration: 1200, type: 'VIDEO' },
        { title: 'Email kamp√°ny tervez√©se', duration: 1200, type: 'VIDEO' },
        { title: 'Social media tartalmak', duration: 1200, type: 'VIDEO' },
        { title: 'Z√°r√≥ projekt √©s √©rt√©kel√©s', duration: 1200, type: 'ASSIGNMENT' }
      ]
    ];
    
    for (let i = 0; i < moduleIds.length; i++) {
      const moduleId = moduleIds[i];
      const lessons = lessonsData[i];
      
      for (let j = 0; j < lessons.length; j++) {
        const lesson = lessons[j];
        await db.collection('lessons').add({
          moduleId,
          courseId,
          title: lesson.title,
          type: lesson.type,
          duration: lesson.duration,
          order: j,
          description: `${lesson.title} - r√©szletes le√≠r√°s`,
          isFreePreview: j === 0, // First lesson is free preview
          isPublished: true,
          createdAt: admin.firestore.FieldValue.serverTimestamp(),
          updatedAt: admin.firestore.FieldValue.serverTimestamp()
        });
      }
      console.log(`‚úÖ Lessons created for module ${i + 1}`);
    }
    
    console.log('\nüéâ Test course seeded successfully!');
    console.log(`üìç Course ID: ${courseId}`);
    console.log(`üîó View at: http://localhost:3000/courses/${courseId}/learn`);
    
  } catch (error) {
    console.error('‚ùå Error seeding course:', error);
  } finally {
    process.exit(0);
  }
}

seedTestCourse();